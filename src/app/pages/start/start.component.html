<ng-template #loading><app-loading /></ng-template>

<ng-container *ngIf="units$ | async as units; else loading">
    <header>
        <h1>{{ greeting }}, {{ userName }}</h1>
        <h2 mat-subheader>Deine Reise</h2>
        <div role="progress">
            @for(unit of units; track $index) {
                <a href="#{{unit.no}}">
                    <app-progress-spinner [value]="0">
                        0%
                    </app-progress-spinner>
                    <span>Einheit {{ unit.no }}</span>
                </a>
                <p>
                    <mat-divider vertical="true" />
                </p>
            }
        </div>
        <small>
            <mat-icon class="small" color="primary" fontIcon="settings"></mat-icon>
            <a role="button" [routerLink]="['/settings']">Daten verwalten</a>
        </small>
    </header>

    @for(unit of units; track $index) {
        <div class="unit">
            <div class="header" [id]="unit.no">
                <span mat-subheader>Einheit {{unit.no}}</span>
                <h3>{{unit.title}}</h3>
            </div>
            <p>
                <mat-divider />
            </p>
            <div class="card-container">
                <mat-card class="card" *ngFor="let section of (unit.pages | async); let j = index">
                    <mat-card-header class="card-header">
                        <div class="card-title">
                            <mat-card-title>
                                <h3>
                                    <a [routerLink]="['/p', $index, j]">
                                        {{section.title}}
                                    </a>
                                </h3>
                            </mat-card-title>
                            @if (section.hero_section) {
                                <mat-card-subtitle>
                                    {{section.hero_section.subhead}}
                                </mat-card-subtitle>
                            }
                        </div>
                        <div class="card-progress">
                            <app-progress-spinner [value]="0">
                                0%
                            </app-progress-spinner>
                        </div>
                    </mat-card-header>
                    <mat-card-content class="card-content">
                        <p>
                            @if (section.hero_section && section.hero_section.image) {
                                <img class="thumbnail" mat-card-image [src]="section.hero_section.image" [alt]="section.hero_section.image_info" />
                            } @else {
                                <mat-divider />
                            }
                        </p>
                    </mat-card-content>
                    <mat-card-footer class="footer">
                        @if (done($index)) {
                            <mat-icon fontIcon="check_box"/> Erledigt
                        } @else {
                            <mat-icon fontIcon="check_box_outline_blank"/> Offen
                        }
                    </mat-card-footer>
                </mat-card>
            </div>
        </div>
    }
</ng-container>