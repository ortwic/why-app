<ng-template #loading><app-loading /></ng-template>

<ng-container *ngIf="currentPage$ | async as page; else loading">
    <app-hero-section [hero-section]="page.hero_section"/>

    @for (item of page.content; track $index) {
        
        @if (item.type === 'iframe' && item.value) {
            <div class="content" [@next]="show($index)"]>
                <iframe [src]="item.value.src | safeUrl" [title]="item.value.title"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen width="560" height="315" frameborder="0"></iframe>
            </div>
        } @else if (item.type === 'text') {
            <div class="content" [@next]="show($index)" [innerHtml]="item.value | marked | async"></div>
        } @else if (item.type === 'stepper') {
            <form class="content" [@next]="show($index)">
                <app-input-stepper [data]="page.data" [definitions]="item.value" (continue)="continue($event)" />
            </form>
        } @else if (item.type === 'slider') {
            <app-image-slider [@next]="show($index)" [images]="item.value" height="50vh" />
        } @else {
            <pre class="content" [@next]="show($index)" title="{{item.type}}">{{item.value | json}}</pre>
        }
    }

    <footer class="centered">
        @if (page.prevIndex !== undefined) {
            <a role="button" mat-button color="primary" aria-label="Zurück"
               [routerLink]="[ '/p', unitIndex, page.prevIndex ]">
                <span class="prev">
                    <mat-icon fontIcon="arrow_back" /> &nbsp;Zurück
                </span>
            </a> 
        }
        @if (page.nextIndex !== undefined) {
            <a role="button" mat-button color="primary" aria-label="Weiter"
               [routerLink]="[ '/p', unitIndex, page.nextIndex ]" 
               (click)="complete(page.data)" [disabled]="page.nextDisabled()">
                <span class="next">
                    <mat-icon fontIcon="arrow_forward" /> Weiter&nbsp;
                </span>
            </a>
        } @else {
            <a role="button" mat-button color="primary" aria-label="Abschließen"
               routerLink="/" [disabled]="page.nextDisabled()" (click)="complete(page.data)">
                <span class="next">            
                    <mat-icon fontIcon="check_small" /> Abschließen&nbsp;
                </span>
            </a>
        }
    </footer>
</ng-container>